
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.util.Vector;
import javax.swing.JOptionPane;
import javax.swing.RowFilter;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableRowSorter;

/**
 *
 * @author Patrick
 */
public class Payment extends javax.swing.JPanel {

    private boolean isNew = false;

    /**
     * Creates new form Payment
     */
    public Payment() {
        initComponents();
        table_update();

        this.Method.setEditable(false);
        this.Code.setEditable(false);
        this.Amount.setEditable(false);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        jPanel12 = new javax.swing.JPanel();
        jLabel43 = new javax.swing.JLabel();
        TxnSrc = new javax.swing.JTextField();
        jLabel44 = new javax.swing.JLabel();
        start = new com.toedter.calendar.JDateChooser();
        end = new com.toedter.calendar.JDateChooser();
        jLabel45 = new javax.swing.JLabel();
        Search = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        newPetty = new javax.swing.JButton();
        savePetty = new javax.swing.JButton();
        Exit = new javax.swing.JButton();
        jPanel6 = new javax.swing.JPanel();
        jLabel35 = new javax.swing.JLabel();
        Method = new javax.swing.JTextField();
        jLabel41 = new javax.swing.JLabel();
        Code = new javax.swing.JTextField();
        jLabel42 = new javax.swing.JLabel();
        Amount = new javax.swing.JTextField();
        jPanel13 = new javax.swing.JPanel();
        jLabel46 = new javax.swing.JLabel();
        TxnSrc1 = new javax.swing.JTextField();
        Search1 = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        PYT = new javax.swing.JTable();

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "ID", "Ref No.", "Description", "Date", "IN", "Out", "Balance", "Invoice No", "Proof of Payment"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable1MouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(jTable1);

        jPanel12.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jLabel43.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel43.setText("Txn ID");

        TxnSrc.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                TxnSrcKeyReleased(evt);
            }
        });

        jLabel44.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel44.setText("<html>\n<p>Starting </br>\n<span>Date</span></p>\n</html>");

        jLabel45.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel45.setText("<html> <p>Ending </br> <span>Date</span></p> </html>");

        Search.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        Search.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Icons/loupe.png"))); // NOI18N
        Search.setText("Search");
        Search.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                SearchActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel12Layout = new javax.swing.GroupLayout(jPanel12);
        jPanel12.setLayout(jPanel12Layout);
        jPanel12Layout.setHorizontalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel12Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel43, javax.swing.GroupLayout.PREFERRED_SIZE, 48, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(TxnSrc)
                .addGap(76, 76, 76)
                .addComponent(jLabel44, javax.swing.GroupLayout.PREFERRED_SIZE, 62, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(start, javax.swing.GroupLayout.PREFERRED_SIZE, 161, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(24, 24, 24)
                .addComponent(jLabel45, javax.swing.GroupLayout.PREFERRED_SIZE, 62, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(end, javax.swing.GroupLayout.PREFERRED_SIZE, 151, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(Search)
                .addGap(277, 277, 277))
        );
        jPanel12Layout.setVerticalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel12Layout.createSequentialGroup()
                .addContainerGap(8, Short.MAX_VALUE)
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(Search)
                    .addComponent(end, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel43)
                        .addComponent(TxnSrc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel44, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(start, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel45, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jLabel3.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel3.setText("Payment Method Management");

        newPetty.setFont(new java.awt.Font("Trebuchet MS", 1, 12)); // NOI18N
        newPetty.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Icons/credit-card-add.png"))); // NOI18N
        newPetty.setText("New");
        newPetty.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                newPettyMouseClicked(evt);
            }
        });
        newPetty.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                newPettyActionPerformed(evt);
            }
        });

        savePetty.setFont(new java.awt.Font("Trebuchet MS", 1, 12)); // NOI18N
        savePetty.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Icons/floppy-disk.png"))); // NOI18N
        savePetty.setText("Save");
        savePetty.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                savePettyActionPerformed(evt);
            }
        });

        Exit.setFont(new java.awt.Font("Trebuchet MS", 1, 12)); // NOI18N
        Exit.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Icons/close.png"))); // NOI18N
        Exit.setText("Clear");
        Exit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ExitActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(newPetty)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(savePetty)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(Exit)
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel3)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(Exit)
                        .addComponent(savePetty)
                        .addComponent(newPetty)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel6.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jLabel35.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel35.setText("Method");

        jLabel41.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel41.setText("Code");

        Code.setEditable(false);

        jLabel42.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel42.setText("Initial Amount");

        Amount.setEditable(false);
        Amount.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                AmountKeyReleased(evt);
            }
        });

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel35, javax.swing.GroupLayout.PREFERRED_SIZE, 69, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel41, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(Method, javax.swing.GroupLayout.PREFERRED_SIZE, 641, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel6Layout.createSequentialGroup()
                        .addComponent(Code, javax.swing.GroupLayout.PREFERRED_SIZE, 176, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jLabel42)
                        .addGap(18, 18, 18)
                        .addComponent(Amount, javax.swing.GroupLayout.PREFERRED_SIZE, 347, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(66, Short.MAX_VALUE))
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel35)
                    .addComponent(Method, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(16, 16, 16)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel42)
                        .addComponent(Amount, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel41)
                        .addComponent(Code, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(13, Short.MAX_VALUE))
        );

        jPanel13.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jLabel46.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel46.setText("Method");

        TxnSrc1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                TxnSrc1KeyReleased(evt);
            }
        });

        Search1.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        Search1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Icons/loupe.png"))); // NOI18N
        Search1.setText("Search");
        Search1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Search1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel13Layout = new javax.swing.GroupLayout(jPanel13);
        jPanel13.setLayout(jPanel13Layout);
        jPanel13Layout.setHorizontalGroup(
            jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel46, javax.swing.GroupLayout.PREFERRED_SIZE, 48, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(TxnSrc1, javax.swing.GroupLayout.PREFERRED_SIZE, 284, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(Search1)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel13Layout.setVerticalGroup(
            jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addContainerGap(8, Short.MAX_VALUE)
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel46)
                    .addComponent(TxnSrc1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(Search1))
                .addGap(12, 12, 12))
        );

        PYT.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "ID", "Method", "Initial Amount"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        PYT.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                PYTMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(PYT);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel13, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jScrollPane2)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel13, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
    }// </editor-fold>//GEN-END:initComponents

    PreparedStatement insert, Bal;

    public final String generateTxnCode() {
        String Code = "";
        try {
            Connection con = Connect.getConnection();
            if (con != null) {
                PreparedStatement statement = con.prepareStatement("SELECT COUNT(Code) FROM Payment");
                ResultSet result = statement.executeQuery();

                if (result.next()) {
                    int count = result.getInt(1);
                    Code = "PYT M" + (000 + count + 1);
                    this.Code.setText(Code);
                }
            }
        } catch (SQLException ex) {
            java.util.logging.Logger.getLogger(Payment.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        return Code;
    }

    private void table_update() {

        int count;

        try {
            Connection con = Connect.getConnection();

            insert = con.prepareStatement("select * from Payment");

            ResultSet rs = insert.executeQuery();
            ResultSetMetaData rsmd = (ResultSetMetaData) rs.getMetaData();
            count = rsmd.getColumnCount();

            DefaultTableModel Df = (DefaultTableModel) PYT.getModel();
            Df.setRowCount(0);

            while (rs.next()) {
                Vector v2 = new Vector();

                for (int i = 1; i <= count; i++) {

                    v2.add(rs.getString("Code"));
                    v2.add(rs.getString("Method"));
                    v2.add(rs.getString("Amount"));

                }

                Df.addRow(v2);
            }

        } catch (SQLException ex) {
            java.util.logging.Logger.getLogger(Payment.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }

    }

    private void newPettyMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_newPettyMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_newPettyMouseClicked

    private void newPettyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_newPettyActionPerformed
        // TODO add your handling code here:

        this.Method.setEditable(true);
        this.Code.setEditable(false);
        this.Amount.setEditable(true);

        generateTxnCode();
        isNew = true;
    }//GEN-LAST:event_newPettyActionPerformed

    private void savePettyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_savePettyActionPerformed
        // TODO add your handling code here:

        if (!ValidateForm.isInternetReachable()) {
            try {
                Connection con = Connect.getConnection();
                con.close();
                JOptionPane.showMessageDialog(null, "There is no internet Connection!", "Internet Connectivity", JOptionPane.ERROR_MESSAGE);
            } catch (SQLException e) {
                e.printStackTrace();
            }
        } else {
            int selectedRow = PYT.getSelectedRow();

            if (isNew && selectedRow < 0) {

                String input3 = this.Method.getText().trim();
                String input8 = this.Code.getText().trim();
                if (input3.isEmpty()) {
                    JOptionPane.showMessageDialog(null, "Please Enter Method Name.", "Error", JOptionPane.ERROR_MESSAGE);
                } else if (input8.isEmpty()) {
                    JOptionPane.showMessageDialog(null, "Please Enter Method Code.", "Error", JOptionPane.ERROR_MESSAGE);
                } else {

                    String Method = this.Method.getText();
                    String Code = this.Code.getText();
                    String Amount = this.Amount.getText();
                    try {

                        Connection con = Connect.getConnection();

                        insert = con.prepareStatement("insert into Payment (Method,Code,Amount) values (?,?,?)");

                        insert.setString(1, Method);
                        insert.setString(2, Code);
                        insert.setString(3, Amount);

                        insert.executeUpdate();

                        if (!Amount.isBlank() && Method.contains("Bank")) {

                            insert = con.prepareStatement("insert into bank(Purpose,BIN,Balance,Bank,TxnId) values (?,?,?,?,?)");
                            insert.setString(1, "Initial Amount");
                            insert.setString(2, Amount);
                            insert.setString(3, Amount);
                            insert.setString(4, Method);
                            insert.setString(5, Code);

                            insert.executeUpdate();

                            Bal = con.prepareStatement("select SUM(BIN) as BIN, SUM(BOUT) as BOUT from bank where bank=?");
                            Bal.setString(1, Method);

                            ResultSet rs = Bal.executeQuery();
                            double IN, OUT, bal = 0;
                            if (rs.next()) {
                                IN = rs.getDouble("BIN");
                                OUT = rs.getDouble("BOUT");
                                bal = IN - OUT;
                            }

                            insert = con.prepareStatement("update bank set Balance=? where TxnId=?");
                            insert.setDouble(1, bal);
                            insert.setString(2, Code);

                            insert.executeUpdate();

                        }

                        JOptionPane.showMessageDialog(null, "New Payment Method Recorded");
                        table_update();

                        this.Method.setText("");
                        this.Code.setText("");
                        this.Amount.setText("");
                        generateTxnCode();

                    } catch (SQLException ex) {
                        java.util.logging.Logger.getLogger(Payment.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
                    }
                }

            } else {
                String input3 = this.Method.getText().trim();
                String input8 = this.Code.getText().trim();
                if (input3.isEmpty()) {
                    JOptionPane.showMessageDialog(null, "Please Enter Method Name.", "Error", JOptionPane.ERROR_MESSAGE);
                } else if (input8.isEmpty()) {
                    JOptionPane.showMessageDialog(null, "Please Enter Method Code.", "Error", JOptionPane.ERROR_MESSAGE);
                } else {

                    String Method = this.Method.getText();
                    String Code = this.Code.getText();
                    String Amount = this.Amount.getText();

                    try {

                        Connection con = Connect.getConnection();

                        insert = con.prepareStatement("update Payment set Method=?,Amount=? where Code=?");

                        insert.setString(1, Method);
                        insert.setString(2, Amount);
                        insert.setString(3, Code);

                        insert.executeUpdate();

                        if (!Amount.isBlank() && Method.contains("Bank")) {

                            insert = con.prepareStatement("update bank set Purpose=?,BIN=?,Balance=?,Bank=? where TxnId=?");
                            insert.setString(1, "Initial Amount");
                            insert.setString(2, Amount);
                            insert.setString(3, Amount);
                            insert.setString(4, Method);
                            insert.setString(5, Code);

                            insert.executeUpdate();

                            Bal = con.prepareStatement("select SUM(BIN) as BIN, SUM(BOUT) as BOUT from bank where bank=?");
                            Bal.setString(1, Method);

                            ResultSet rs = Bal.executeQuery();
                            double IN, OUT, bal = 0;
                            if (rs.next()) {
                                IN = rs.getDouble("BIN");
                                OUT = rs.getDouble("BOUT");
                                bal = IN - OUT;
                            }

                            insert = con.prepareStatement("update bank set Balance=? where TxnId=?");
                            insert.setDouble(1, bal);
                            insert.setString(2, Code);

                            insert.executeUpdate();

                        } else {

                            insert = con.prepareStatement("delete from bank where TxnId=?");
                            insert.setString(1, Code);

                        }

                        JOptionPane.showMessageDialog(null, "Payment Method Updated!");
                        table_update();

                        this.Method.setText("");
                        this.Code.setText("");
                        this.Amount.setText("");
                        generateTxnCode();

                    } catch (SQLException ex) {
                        java.util.logging.Logger.getLogger(Payment.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
                    }
                }
            }
        }
    }//GEN-LAST:event_savePettyActionPerformed

    private void ExitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ExitActionPerformed
        // TODO add your handling code here:

        this.Method.setText("");
        this.Code.setText("");
        this.Amount.setText("");

        generateTxnCode();

    }//GEN-LAST:event_ExitActionPerformed

    private void TxnSrcKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_TxnSrcKeyReleased
        // TODO add your handling code here:

        DefaultTableModel src = (DefaultTableModel) PYT.getModel();
        TableRowSorter<DefaultTableModel> obj = new TableRowSorter<>(src);
        PYT.setRowSorter(obj);
        obj.setRowFilter(RowFilter.regexFilter(TxnSrc.getText(), 0));
    }//GEN-LAST:event_TxnSrcKeyReleased

    private void SearchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_SearchActionPerformed
        // TODO add your handling code here:


    }//GEN-LAST:event_SearchActionPerformed

    private void jTable1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable1MouseClicked
        // TODO add your handling code here:

        DefaultTableModel Df = (DefaultTableModel) PYT.getModel();
        int selectedIndex = PYT.getSelectedRow();

        this.Code.setText(Df.getValueAt(selectedIndex, 0).toString());
        this.Method.setText(Df.getValueAt(selectedIndex, 1).toString());

    }//GEN-LAST:event_jTable1MouseClicked

    private void TxnSrc1KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_TxnSrc1KeyReleased
        // TODO add your handling code here:

        DefaultTableModel src = (DefaultTableModel) PYT.getModel();
        TableRowSorter<DefaultTableModel> obj = new TableRowSorter<>(src);
        PYT.setRowSorter(obj);
        obj.setRowFilter(RowFilter.regexFilter(TxnSrc.getText(), 1));
    }//GEN-LAST:event_TxnSrc1KeyReleased

    private void Search1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Search1ActionPerformed
        // TODO add your handling code here:

        DefaultTableModel src = (DefaultTableModel) PYT.getModel();
        TableRowSorter<DefaultTableModel> obj = new TableRowSorter<>(src);
        PYT.setRowSorter(obj);
        obj.setRowFilter(RowFilter.regexFilter(TxnSrc.getText(), 1));
    }//GEN-LAST:event_Search1ActionPerformed

    private void PYTMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_PYTMouseClicked
        // TODO add your handling code here:

        DefaultTableModel Df = (DefaultTableModel) PYT.getModel();
        int selectedIndex = PYT.getSelectedRow();

        this.Code.setText(Df.getValueAt(selectedIndex, 0).toString());
        this.Method.setText(Df.getValueAt(selectedIndex, 1).toString());
        this.Amount.setText(Df.getValueAt(selectedIndex, 2).toString());
    }//GEN-LAST:event_PYTMouseClicked

    private void AmountKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_AmountKeyReleased
        // TODO add your handling code here:
        char c = evt.getKeyChar();

        if (!Character.isDigit(c)) {
            evt.consume();
        }/*
        
        if (c == '.' && ((JTextField) evt.getSource()).getText().contains(".")) {
        evt.consume();
        }*/

    }//GEN-LAST:event_AmountKeyReleased


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField Amount;
    private javax.swing.JTextField Code;
    private javax.swing.JButton Exit;
    private javax.swing.JTextField Method;
    private javax.swing.JTable PYT;
    private javax.swing.JButton Search;
    private javax.swing.JButton Search1;
    private javax.swing.JTextField TxnSrc;
    private javax.swing.JTextField TxnSrc1;
    private com.toedter.calendar.JDateChooser end;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel35;
    private javax.swing.JLabel jLabel41;
    private javax.swing.JLabel jLabel42;
    private javax.swing.JLabel jLabel43;
    private javax.swing.JLabel jLabel44;
    private javax.swing.JLabel jLabel45;
    private javax.swing.JLabel jLabel46;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel13;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTable jTable1;
    private javax.swing.JButton newPetty;
    private javax.swing.JButton savePetty;
    private com.toedter.calendar.JDateChooser start;
    // End of variables declaration//GEN-END:variables
}
